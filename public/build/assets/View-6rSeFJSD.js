import{J as oe,e as se,F as Y,g as y,D as ne,K as le,l as x,a9 as re,z as de,N as ie,a5 as ce,r,o as i,c as g,a as o,w as n,m as s,O as ue,n as V,q as me,t as h,I as w,b as l,L as A,M as fe,H as pe}from"./main-vzIkKseS.js";import{u as _e}from"./payment-ALr-TD5m.js";import{_ as ye,a as ge}from"./SendPaymentModal-4tmkg0dz.js";import{L as he}from"./LoadingIcon-fUkhTV3p.js";import"./mail-driver-9YpfUUN4.js";const be={class:"fixed top-0 left-0 hidden h-full pt-16 pb-[6rem] ml-56 bg-white xl:ml-64 w-88 xl:block"},ve={class:"flex items-center justify-between px-4 pt-8 pb-6 border border-gray-200 border-solid"},Be={class:"flex ml-3",role:"group","aria-label":"First group"},xe={class:"px-4 py-1 pb-2 mb-2 text-sm border-b border-gray-200 border-solid"},we={class:"px-2"},ke={class:"px-2"},Fe={class:"px-2"},Ie={class:"flex-2"},Ve={class:"mb-1 text-xs not-italic font-medium leading-5 text-gray-500 capitalize"},Pe={class:"mb-1 text-xs not-italic font-medium leading-5 text-gray-500 capitalize"},Te={class:"flex-1 whitespace-nowrap right"},Se={class:"text-sm text-right text-gray-500 non-italic"},De={key:0,class:"flex justify-center p-4 items-center"},$e={key:1,class:"flex justify-center px-4 mt-5 text-sm text-gray-600"},Le={class:"flex flex-col min-h-0 mt-8 overflow-hidden",style:{height:"75vh"}},ze=["src"],He={setup(Me){const _=oe(),{t:P}=se();let f=Y({}),a=Y({orderBy:null,orderByField:null,searchText:null}),b=y(!1),k=y(!1);const v=_e(),O=ne(),q=le(),c=y(null),B=y(1),T=y(1),M=y(null),R=x(()=>f.payment_number||""),N=x(()=>a.orderBy==="asc"||a.orderBy==null);x(()=>N.value?P("general.ascending"):P("general.descending"));const j=x(()=>f.unique_hash?`/payments/pdf/${f.unique_hash}`:!1);x(()=>{var t;return re((t=v==null?void 0:v.selectedPayment)==null?void 0:t.payment_date).format("YYYY/MM/DD")}),de(_,()=>{C()}),F(),C(),m=ie.debounce(m,500);function G(t){return _.params.id==t}ce();async function F(t,d=!1){if(b.value)return;let u={};a.searchText!==""&&a.searchText!==null&&a.searchText!==void 0&&(u.search=a.searchText),a.orderBy!==null&&a.orderBy!==void 0&&(u.orderBy=a.orderBy),a.orderByField!==null&&a.orderByField!==void 0&&(u.orderByField=a.orderByField),b.value=!0;let I=await v.fetchPayments({page:t,...u});b.value=!1,c.value=c.value?c.value:[],c.value=[...c.value,...I.data.data],B.value=t||1,T.value=I.data.meta.last_page;let p=c.value.find(S=>S.id==_.params.id);d==!1&&!p&&B.value<T.value&&Object.keys(u).length===0&&F(++B.value),p&&setTimeout(()=>{d==!1&&J()},500)}async function C(){if(!_.params.id)return;k.value=!0;let t=await v.fetchPayment(_.params.id);t.data&&(k.value=!1,Object.assign(f,t.data.data))}function J(){const t=document.getElementById(`payment-${_.params.id}`);t&&(t.scrollIntoView({behavior:"smooth"}),t.classList.add("shake"),K())}function K(){M.value.addEventListener("scroll",t=>{t.target.scrollTop>0&&t.target.scrollTop+t.target.clientHeight>t.target.scrollHeight-200&&B.value<T.value&&F(++B.value,!0)})}async function m(){c.value=[],F()}function Q(){return a.orderBy==="asc"?(a.orderBy="desc",m(),!0):(a.orderBy="asc",m(),!0)}async function W(){O.openModal({title:P("payments.send_payment"),componentName:"SendPaymentModal",id:f.id,data:f,variant:"lg"})}return(t,d)=>{const u=r("BaseButton"),I=r("BasePageHeader"),p=r("BaseIcon"),S=r("BaseInput"),D=r("BaseRadio"),$=r("BaseInputGroup"),L=r("BaseDropdownItem"),X=r("BaseDropdown"),Z=r("BaseText"),ee=r("BaseFormatMoney"),te=r("router-link"),ae=r("BasePage");return i(),g(A,null,[o(ye),o(ae,{class:"xl:pl-96"},{default:n(()=>{var E;return[o(I,{title:s(R)},{actions:n(()=>[s(q).hasAbilities(s(ue).SEND_PAYMENT)?(i(),V(u,{key:0,"content-loading":s(k),variant:"primary",onClick:W},{default:n(()=>[me(h(t.$t("payments.send_payment_receipt")),1)]),_:1},8,["content-loading"])):w("",!0),o(ge,{"content-loading":s(k),class:"ml-3",row:s(f)},null,8,["content-loading","row"])]),_:1},8,["title"]),l("div",be,[l("div",ve,[o(S,{modelValue:s(a).searchText,"onUpdate:modelValue":d[0]||(d[0]=e=>s(a).searchText=e),placeholder:t.$t("general.search"),type:"text",onInput:m},{default:n(()=>[o(p,{name:"SearchIcon",class:"h-5"})]),_:1},8,["modelValue","placeholder"]),l("div",Be,[o(X,{position:"bottom-start","width-class":"w-50","position-class":"left-0"},{activator:n(()=>[o(u,{variant:"gray"},{default:n(()=>[o(p,{name:"FilterIcon"})]),_:1})]),default:n(()=>[l("div",xe,h(t.$t("general.sort_by")),1),l("div",we,[o(L,{class:"pt-3 rounded-md hover:rounded-md"},{default:n(()=>[o($,{class:"-mt-3 font-normal"},{default:n(()=>[o(D,{id:"filter_invoice_number",modelValue:s(a).orderByField,"onUpdate:modelValue":[d[1]||(d[1]=e=>s(a).orderByField=e),m],label:t.$t("invoices.title"),size:"sm",name:"filter",value:"invoice_number"},null,8,["modelValue","label"])]),_:1})]),_:1})]),l("div",ke,[o(L,{class:"pt-3 rounded-md hover:rounded-md"},{default:n(()=>[o($,{class:"-mt-3 font-normal"},{default:n(()=>[o(D,{modelValue:s(a).orderByField,"onUpdate:modelValue":[d[2]||(d[2]=e=>s(a).orderByField=e),m],label:t.$t("payments.date"),size:"sm",name:"filter",value:"payment_date"},null,8,["modelValue","label"])]),_:1})]),_:1})]),l("div",Fe,[o(L,{class:"pt-3 rounded-md hover:rounded-md"},{default:n(()=>[o($,{class:"-mt-3 font-normal"},{default:n(()=>[o(D,{id:"filter_payment_number",modelValue:s(a).orderByField,"onUpdate:modelValue":[d[3]||(d[3]=e=>s(a).orderByField=e),m],label:t.$t("payments.payment_number"),size:"sm",name:"filter",value:"payment_number"},null,8,["modelValue","label"])]),_:1})]),_:1})])]),_:1}),o(u,{class:"ml-1",size:"md",variant:"gray",onClick:Q},{default:n(()=>[s(N)?(i(),V(p,{key:0,name:"SortAscendingIcon"})):(i(),V(p,{key:1,name:"SortDescendingIcon"}))]),_:1})])]),l("div",{ref:(e,z)=>{z.paymentListSection=e,M.value=e},class:"h-full overflow-y-scroll border-l border-gray-200 border-solid"},[(i(!0),g(A,null,fe(c.value,(e,z)=>(i(),g("div",{key:z},[e?(i(),V(te,{key:0,id:"payment-"+e.id,to:`/admin/payments/${e.id}/view`,class:pe(["flex justify-between p-4 items-center cursor-pointer hover:bg-gray-100 border-l-4 border-transparent",{"bg-gray-100 border-l-4 border-primary-500 border-solid":G(e.id)}]),style:{"border-bottom":"1px solid rgba(185, 193, 209, 0.41)"}},{default:n(()=>{var U,H;return[l("div",Ie,[o(Z,{text:(U=e==null?void 0:e.customer)==null?void 0:U.name,length:30,class:"pr-2 mb-2 text-sm not-italic font-normal leading-5 text-black capitalize truncate"},null,8,["text"]),l("div",Ve,h(e==null?void 0:e.payment_number),1),l("div",Pe,h(e==null?void 0:e.invoice_number),1)]),l("div",Te,[o(ee,{class:"block mb-2 text-xl not-italic font-semibold leading-8 text-right text-gray-900",amount:e==null?void 0:e.amount,currency:(H=e.customer)==null?void 0:H.currency},null,8,["amount","currency"]),l("div",Se,h(e.formatted_payment_date),1)])]}),_:2},1032,["id","to","class"])):w("",!0)]))),128)),s(b)?(i(),g("div",De,[o(he,{class:"h-6 m-1 animate-spin text-primary-400"})])):w("",!0),!((E=c.value)!=null&&E.length)&&!s(b)?(i(),g("p",$e,h(t.$t("payments.no_matching_payments")),1)):w("",!0)],512)]),l("div",Le,[s(j)?(i(),g("iframe",{key:0,src:s(j),class:"flex-1 border border-gray-400 border-solid rounded-md"},null,8,ze)):w("",!0)])]}),_:1})],64)}}};export{He as default};
