import{aq as P,r as s,o as d,c as E,a as t,l as n,w as a,E as A,ae as J,av as K,v as O,L as X,e as Y,f as C,k as I,g as _,h as y,ai as Q,ag as W,X as Z,j as ee,z as ne,m as b,K as k,b as $,t as L,J as te,p as oe,q as ie,N as ae}from"./main-B9dpPbRR.js";import{_ as se,a as le,b as ce,c as re,d as ue,e as de,f as me}from"./SalesTax-ipNfFfG-.js";import{_ as ve}from"./ExchangeRateConverter-aybyIXMj.js";import{_ as ge}from"./CreateCustomFields-blY-YoZ8.js";import{_ as pe}from"./TaxTypeModal-jyzjEMpe.js";import"./DragIcon-w0U5hiz6.js";import"./SelectNotePopup-5BlBNAE0.js";import"./NoteModal-h_90cxoW.js";import"./payment-Y8OywN76.js";import"./exchange-rate-M4ruO0OO.js";import"./dynamic-import-helper-0gtGTknh.js";const _e={class:"grid grid-cols-12 gap-8 mt-6 mb-8"},fe={__name:"InvoiceCreateBasicFields",props:{v:{type:Object,default:null},isLoading:{type:Boolean,default:!1},isEdit:{type:Boolean,default:!1}},setup(o){const e=P();return(m,l)=>{const B=s("BaseCustomerSelectPopup"),c=s("BaseDatePicker"),v=s("BaseInputGroup"),h=s("BaseInput"),u=s("BaseInputGrid");return d(),E("div",_e,[t(B,{modelValue:n(e).newInvoice.customer,"onUpdate:modelValue":l[0]||(l[0]=r=>n(e).newInvoice.customer=r),valid:o.v.customer_id,"content-loading":o.isLoading,type:"invoice",class:"col-span-12 lg:col-span-5 pr-0"},null,8,["modelValue","valid","content-loading"]),t(u,{class:"col-span-12 lg:col-span-7"},{default:a(()=>[t(v,{label:m.$t("invoices.invoice_date"),"content-loading":o.isLoading,required:"",error:o.v.invoice_date.$error&&o.v.invoice_date.$errors[0].$message},{default:a(()=>[t(c,{modelValue:n(e).newInvoice.invoice_date,"onUpdate:modelValue":l[1]||(l[1]=r=>n(e).newInvoice.invoice_date=r),"content-loading":o.isLoading,"calendar-button":!0,"calendar-button-icon":"calendar"},null,8,["modelValue","content-loading"])]),_:1},8,["label","content-loading","error"]),t(v,{label:m.$t("invoices.due_date"),"content-loading":o.isLoading},{default:a(()=>[t(c,{modelValue:n(e).newInvoice.due_date,"onUpdate:modelValue":l[2]||(l[2]=r=>n(e).newInvoice.due_date=r),"content-loading":o.isLoading,"calendar-button":!0,"calendar-button-icon":"calendar"},null,8,["modelValue","content-loading"])]),_:1},8,["label","content-loading"]),t(v,{label:m.$t("invoices.invoice_number"),"content-loading":o.isLoading,error:o.v.invoice_number.$error&&o.v.invoice_number.$errors[0].$message,required:""},{default:a(()=>[t(h,{modelValue:n(e).newInvoice.invoice_number,"onUpdate:modelValue":l[3]||(l[3]=r=>n(e).newInvoice.invoice_number=r),"content-loading":o.isLoading,onInput:l[4]||(l[4]=r=>o.v.invoice_number.$touch())},null,8,["modelValue","content-loading"])]),_:1},8,["label","content-loading","error"]),t(ve,{store:n(e),"store-prop":"newInvoice",v:o.v,"is-loading":o.isLoading,"is-edit":o.isEdit,"customer-currency":n(e).newInvoice.currency_id},null,8,["store","v","is-loading","is-edit","customer-currency"])]),_:1})])}}},Ie={class:"flex"},be={class:"block mt-10 invoice-foot lg:flex lg:justify-between lg:items-start"},we={class:"relative w-full lg:w-1/2 lg:mr-4"},q="newInvoice",Ee={__name:"InvoiceCreate",setup(o){const e=P(),m=A(),l=J(),B=K(),{t:c}=O.useI18n();let v=X(),h=Y(),u=C(!1);const r=C(!1),F=C(["customer","company","customerCustom","invoice","invoiceCustom"]);let f=I(()=>e.isFetchingInvoice||e.isFetchingInitialSettings),M=I(()=>g.value?c("invoices.edit_invoice"):c("invoices.new_invoice"));const T=I(()=>m.selectedCompanySettings.sales_tax_us_enabled==="YES"&&B.salesTaxUSEnabled);let g=I(()=>v.name==="invoices.edit");const x={invoice_date:{required:_.withMessage(c("validation.required"),y)},reference_number:{maxLength:_.withMessage(c("validation.price_maxlength"),Q(255))},customer_id:{required:_.withMessage(c("validation.required"),y)},invoice_number:{required:_.withMessage(c("validation.required"),y)},exchange_rate:{required:W(function(){return _.withMessage(c("validation.required"),y),e.showExchangeRate}),decimal:_.withMessage(c("validation.valid_exchange_rate"),Z)}},w=ee(x,I(()=>e.newInvoice),{$scope:q});l.resetCustomFields(),w.value.$reset,e.resetCurrentInvoice(),e.fetchInvoiceInitialSettings(g.value),ne(()=>e.newInvoice.customer,i=>{i&&i.currency?e.newInvoice.selectedCurrency=i.currency:e.newInvoice.selectedCurrency=m.selectedCompanyCurrency});async function N(){if(w.value.$touch(),w.value.$invalid)return!1;u.value=!0;let i={...e.newInvoice,sub_total:e.getSubTotal,total:e.getTotal,tax:e.getTotalTax};try{const p=await(g.value?e.updateInvoice:e.addInvoice)(i);h.push(`/admin/invoices/${p.data.data.id}/view`)}catch(S){console.error(S)}u.value=!1}return(i,S)=>{const p=s("BaseBreadcrumbItem"),U=s("BaseBreadcrumb"),V=s("BaseButton"),j=s("router-link"),D=s("BaseIcon"),G=s("BasePageHeader"),R=s("BaseScrollPane"),z=s("BasePage");return d(),E(ae,null,[t(se),t(le),t(pe),T.value&&(!n(f)||n(v).query.customer)?(d(),b(ce,{key:0,store:n(e),"is-edit":n(g),"store-prop":"newInvoice",customer:n(e).newInvoice.customer},null,8,["store","is-edit","customer"])):k("",!0),t(z,{class:"relative invoice-create-page"},{default:a(()=>[$("form",{onSubmit:ie(N,["prevent"])},[t(G,{title:n(M)},{actions:a(()=>[i.$route.name==="invoices.edit"?(d(),b(j,{key:0,to:`/invoices/pdf/${n(e).newInvoice.unique_hash}`,target:"_blank"},{default:a(()=>[t(V,{class:"mr-3",variant:"primary-outline",type:"button"},{default:a(()=>[$("span",Ie,L(i.$t("general.view_pdf")),1)]),_:1})]),_:1},8,["to"])):k("",!0),t(V,{loading:n(u),disabled:n(u),variant:"primary",type:"submit"},{left:a(H=>[n(u)?k("",!0):(d(),b(D,{key:0,name:"SaveIcon",class:te(H.class)},null,8,["class"]))]),default:a(()=>[oe(" "+L(i.$t("invoices.save_invoice")),1)]),_:1},8,["loading","disabled"])]),default:a(()=>[t(U,null,{default:a(()=>[t(p,{title:i.$t("general.home"),to:"/admin/dashboard"},null,8,["title"]),t(p,{title:i.$t("invoices.invoice",2),to:"/admin/invoices"},null,8,["title"]),i.$route.name==="invoices.edit"?(d(),b(p,{key:0,title:i.$t("invoices.edit_invoice"),to:"#",active:""},null,8,["title"])):(d(),b(p,{key:1,title:i.$t("invoices.new_invoice"),to:"#",active:""},null,8,["title"]))]),_:1})]),_:1},8,["title"]),t(fe,{v:n(w),"is-loading":n(f),"is-edit":n(g)},null,8,["v","is-loading","is-edit"]),t(R,null,{default:a(()=>[t(re,{currency:n(e).newInvoice.selectedCurrency,"is-loading":n(f),"item-validation-scope":q,store:n(e),"store-prop":"newInvoice"},null,8,["currency","is-loading","store"]),$("div",be,[$("div",we,[t(ue,{store:n(e),"store-prop":"newInvoice",fields:F.value,type:"Invoice"},null,8,["store","fields"]),t(ge,{type:"Invoice","is-edit":n(g),"is-loading":n(f),store:n(e),"store-prop":"newInvoice","custom-field-scope":q,class:"mb-6"},null,8,["is-edit","is-loading","store"]),t(de,{store:n(e),"store-prop":"newInvoice","component-name":"InvoiceTemplate","is-mark-as-default":r.value},null,8,["store","is-mark-as-default"])]),t(me,{currency:n(e).newInvoice.selectedCurrency,"is-loading":n(f),store:n(e),"store-prop":"newInvoice","tax-popup-type":"invoice"},null,8,["currency","is-loading","store"])])]),_:1})],32)]),_:1})],64)}}};export{Ee as default};
