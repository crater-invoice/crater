import{a6 as M,J as O,e as X,g as F,F as R,N as ee,l as E,r as d,o,c as v,b as l,a as t,w as n,m as e,t as b,n as m,L as q,M as G,I as f,H as J,q as A,X as te,C as se,a3 as K,z as ae,p as ne,a5 as oe,K as le,f as re,O as S}from"./main-vzIkKseS.js";import{L as ce}from"./LoadingIcon-fUkhTV3p.js";import{_ as ie}from"./LineChart-wa69n_NW.js";import{_ as de}from"./CustomerIndexDropdown-dSzhysTu.js";const ue={class:"fixed top-0 left-0 hidden h-full pt-16 pb-[6.6rem] ml-56 bg-white xl:ml-64 w-88 xl:block"},me={class:"flex items-center justify-between px-4 pt-8 pb-2 border border-gray-200 border-solid height-full"},_e={class:"flex mb-6 ml-3",role:"group","aria-label":"First group"},pe={class:"px-4 py-3 pb-2 mb-2 text-sm border-b border-gray-200 border-solid"},fe={class:"px-2"},he={class:"px-2"},ye={class:"flex-1 font-bold text-right whitespace-nowrap"},ge={key:0,class:"flex justify-center p-4 items-center"},xe={key:1,class:"flex justify-center px-4 mt-5 text-sm text-gray-600"},be={setup(j){const C=M(),s=O(),{t:u}=X();let r=F(!1),a=R({orderBy:null,orderByField:null,searchText:null});const _=F(null),y=F(1),g=F(1),I=F(null);i=ee.debounce(i,500);const h=E(()=>a.orderBy==="asc"||a.orderBy==null);E(()=>h.value?u("general.ascending"):u("general.descending"));function B(c){return s.params.id==c}async function x(c,w=!1){if(r.value)return;let T={};a.searchText!==""&&a.searchText!==null&&a.searchText!==void 0&&(T.display_name=a.searchText),a.orderBy!==null&&a.orderBy!==void 0&&(T.orderBy=a.orderBy),a.orderByField!==null&&a.orderByField!==void 0&&(T.orderByField=a.orderByField),r.value=!0;let P=await C.fetchCustomers({page:c,...T,limit:15});r.value=!1,_.value=_.value?_.value:[],_.value=[..._.value,...P.data.data],y.value=c||1,g.value=P.data.meta.last_page;let V=_.value.find(L=>L.id==s.params.id);w==!1&&!V&&y.value<g.value&&Object.keys(T).length===0&&x(++y.value),V&&setTimeout(()=>{w==!1&&$()},500)}function $(){const c=document.getElementById(`customer-${s.params.id}`);c&&(c.scrollIntoView({behavior:"smooth"}),c.classList.add("shake"),D())}function D(){I.value.addEventListener("scroll",c=>{c.target.scrollTop>0&&c.target.scrollTop+c.target.clientHeight>c.target.scrollHeight-200&&y.value<g.value&&x(++y.value,!0)})}async function i(){_.value=[],x()}function k(){return a.orderBy==="asc"?(a.orderBy="desc",i(),!0):(a.orderBy="asc",i(),!0)}return x(),(c,w)=>{var Y;const T=d("BaseIcon"),P=d("BaseInput"),V=d("BaseButton"),L=d("BaseRadio"),U=d("BaseInputGroup"),z=d("BaseDropdownItem"),Q=d("BaseDropdown"),H=d("BaseText"),W=d("BaseFormatMoney"),Z=d("router-link");return o(),v("div",ue,[l("div",me,[t(P,{modelValue:e(a).searchText,"onUpdate:modelValue":w[0]||(w[0]=p=>e(a).searchText=p),placeholder:c.$t("general.search"),"container-class":"mb-6",type:"text",variant:"gray",onInput:w[1]||(w[1]=p=>i())},{default:n(()=>[t(T,{name:"SearchIcon",class:"text-gray-500"})]),_:1},8,["modelValue","placeholder"]),l("div",_e,[t(Q,{"close-on-select":!1,position:"bottom-start","width-class":"w-40","position-class":"left-0"},{activator:n(()=>[t(V,{variant:"gray"},{default:n(()=>[t(T,{name:"FilterIcon"})]),_:1})]),default:n(()=>[l("div",pe,b(c.$t("general.sort_by")),1),l("div",fe,[t(z,{class:"flex px-1 py-2 mt-1 cursor-pointer hover:rounded-md"},{default:n(()=>[t(U,{class:"pt-2 -mt-4"},{default:n(()=>[t(L,{id:"filter_create_date",modelValue:e(a).orderByField,"onUpdate:modelValue":[w[2]||(w[2]=p=>e(a).orderByField=p),i],label:c.$t("customers.create_date"),size:"sm",name:"filter",value:"invoices.created_at"},null,8,["modelValue","label"])]),_:1})]),_:1})]),l("div",he,[t(z,{class:"flex px-1 cursor-pointer hover:rounded-md"},{default:n(()=>[t(U,{class:"pt-2 -mt-4"},{default:n(()=>[t(L,{id:"filter_display_name",modelValue:e(a).orderByField,"onUpdate:modelValue":[w[3]||(w[3]=p=>e(a).orderByField=p),i],label:c.$t("customers.display_name"),size:"sm",name:"filter",value:"name"},null,8,["modelValue","label"])]),_:1})]),_:1})])]),_:1}),t(V,{class:"ml-1",size:"md",variant:"gray",onClick:k},{default:n(()=>[e(h)?(o(),m(T,{key:0,name:"SortAscendingIcon"})):(o(),m(T,{key:1,name:"SortDescendingIcon"}))]),_:1})])]),l("div",{ref:(p,N)=>{N.customerListSection=p,I.value=p},class:"h-full overflow-y-scroll border-l border-gray-200 border-solid sidebar base-scroll"},[(o(!0),v(q,null,G(_.value,(p,N)=>(o(),v("div",{key:N},[p?(o(),m(Z,{key:0,id:"customer-"+p.id,to:`/admin/customers/${p.id}/view`,class:J(["flex justify-between p-4 items-center cursor-pointer hover:bg-gray-100 border-l-4 border-transparent",{"bg-gray-100 border-l-4 border-primary-500 border-solid":B(p.id)}]),style:{"border-top":"1px solid rgba(185, 193, 209, 0.41)"}},{default:n(()=>[l("div",null,[t(H,{text:p.name,length:30,class:"pr-2 text-sm not-italic font-normal leading-5 text-black capitalize truncate"},null,8,["text"]),p.contact_name?(o(),m(H,{key:0,text:p.contact_name,length:30,class:"mt-1 text-xs not-italic font-medium leading-5 text-gray-600"},null,8,["text"])):f("",!0)]),l("div",ye,[t(W,{amount:p.due_amount!==null?p.due_amount:0,currency:p.currency},null,8,["amount","currency"])])]),_:2},1032,["id","to","class"])):f("",!0)]))),128)),e(r)?(o(),v("div",ge,[t(ce,{class:"h-6 m-1 animate-spin text-primary-400"})])):f("",!0),!((Y=_.value)!=null&&Y.length)&&!e(r)?(o(),v("p",xe,b(c.$t("customers.no_matching_customers")),1)):f("",!0)],512)])}}},ve={class:"pt-6 mt-5 border-t border-solid lg:pt-8 md:pt-4 border-gray-200"},Be={key:0,class:"text-sm font-bold leading-5 text-black non-italic"},$e={key:0},we={key:1},Te={key:1,class:"text-sm font-bold leading-5 text-black non-italic"},Ce={setup(j){const C=M(),s=E(()=>C.selectedViewCustomer),u=E(()=>C.isFetchingViewData),r=E(()=>{var a,_;return(a=s==null?void 0:s.value)!=null&&a.fields?(_=s==null?void 0:s.value)==null?void 0:_.fields:[]});return(a,_)=>{const y=d("BaseHeading"),g=d("BaseDescriptionListItem"),I=d("BaseDescriptionList"),h=d("BaseCustomerAddressDisplay");return o(),v("div",ve,[t(y,null,{default:n(()=>[A(b(a.$t("customers.basic_info")),1)]),_:1}),t(I,null,{default:n(()=>{var B,x,$;return[t(g,{"content-loading":e(u),label:a.$t("customers.display_name"),value:(B=e(s))==null?void 0:B.name},null,8,["content-loading","label","value"]),t(g,{"content-loading":e(u),label:a.$t("customers.primary_contact_name"),value:(x=e(s))==null?void 0:x.contact_name},null,8,["content-loading","label","value"]),t(g,{"content-loading":e(u),label:a.$t("customers.email"),value:($=e(s))==null?void 0:$.email},null,8,["content-loading","label","value"])]}),_:1}),t(I,{class:"mt-5"},{default:n(()=>{var B,x,$,D,i,k,c;return[t(g,{"content-loading":e(u),label:a.$t("wizard.currency"),value:(B=e(s))!=null&&B.currency?`${($=(x=e(s))==null?void 0:x.currency)==null?void 0:$.code} (${(i=(D=e(s))==null?void 0:D.currency)==null?void 0:i.symbol})`:""},null,8,["content-loading","label","value"]),t(g,{"content-loading":e(u),label:a.$t("customers.phone_number"),value:(k=e(s))==null?void 0:k.phone},null,8,["content-loading","label","value"]),t(g,{"content-loading":e(u),label:a.$t("customers.website"),value:(c=e(s))==null?void 0:c.website},null,8,["content-loading","label","value"])]}),_:1}),e(s).billing||e(s).shipping?(o(),m(y,{key:0,class:"mt-8"},{default:n(()=>[A(b(a.$t("customers.address")),1)]),_:1})):f("",!0),t(I,{class:"mt-5"},{default:n(()=>[e(s).billing?(o(),m(g,{key:0,"content-loading":e(u),label:a.$t("customers.billing_address")},{default:n(()=>[t(h,{address:e(s).billing},null,8,["address"])]),_:1},8,["content-loading","label"])):f("",!0),e(s).shipping?(o(),m(g,{key:1,"content-loading":e(u),label:a.$t("customers.shipping_address")},{default:n(()=>[t(h,{address:e(s).shipping},null,8,["address"])]),_:1},8,["content-loading","label"])):f("",!0)]),_:1}),e(r).length>0?(o(),m(y,{key:1,class:"mt-8"},{default:n(()=>[A(b(a.$t("settings.custom_fields.title")),1)]),_:1})):f("",!0),t(I,{class:"mt-5"},{default:n(()=>[(o(!0),v(q,null,G(e(r),(B,x)=>(o(),m(g,{key:x,"content-loading":e(u),label:B.custom_field.label},{default:n(()=>[B.type==="Switch"?(o(),v("p",Be,[B.default_answer===1?(o(),v("span",$e," Yes ")):(o(),v("span",we," No "))])):(o(),v("p",Te,b(B.default_answer),1))]),_:2},1032,["content-loading","label"]))),128))]),_:1})])}}},ke={},Ee={class:"col-span-12 xl:col-span-9 xxl:col-span-10"},Ie={class:"flex justify-between mt-1 mb-6"},De={class:"grid col-span-12 mt-6 text-center xl:mt-0 sm:grid-cols-4 xl:text-right xl:col-span-3 xl:grid-cols-1 xxl:col-span-2"},Se={class:"flex flex-col items-center justify-center px-6 py-2 lg:justify-end lg:items-end"},Ae={class:"flex flex-col items-center justify-center px-6 py-2 lg:justify-end lg:items-end"},Ve={class:"flex flex-col items-center justify-center px-6 py-2 lg:justify-end lg:items-end"},Fe={class:"flex flex-col items-center justify-center px-6 py-2 lg:justify-end lg:items-end"};function Pe(j,C){const s=d("BaseContentPlaceholdersText"),u=d("BaseContentPlaceholdersBox"),r=d("BaseContentPlaceholders");return o(),m(r,{class:"grid grid-cols-12"},{default:n(()=>[l("div",Ee,[l("div",Ie,[t(s,{class:"h-10 w-36",lines:1}),t(s,{class:"h-10 w-40 !mt-0",lines:1})]),t(u,{class:"h-80 xl:h-72 sm:w-full"})]),l("div",De,[l("div",Se,[t(s,{class:"h-3 w-14 xl:h-4",lines:1}),t(s,{class:"w-20 h-5 xl:h-6",lines:1})]),l("div",Ae,[t(s,{class:"h-3 w-14 xl:h-4",lines:1}),t(s,{class:"w-20 h-5 xl:h-6",lines:1})]),l("div",Ve,[t(s,{class:"h-3 w-14 xl:h-4",lines:1}),t(s,{class:"w-20 h-5 xl:h-6",lines:1})]),l("div",Fe,[t(s,{class:"h-3 w-14 xl:h-4",lines:1}),t(s,{class:"w-20 h-5 xl:h-6",lines:1})])])]),_:1})}const je=te(ke,[["render",Pe]]),Le={key:1,class:"grid grid-cols-12"},Re={class:"col-span-12 xl:col-span-9 xxl:col-span-10"},Me={class:"flex justify-between mt-1 mb-6"},Ne={class:"flex items-center"},Oe={class:"w-40 h-10"},Ue={class:"grid col-span-12 mt-6 text-center xl:mt-0 sm:grid-cols-4 xl:text-right xl:col-span-3 xl:grid-cols-1 xxl:col-span-2"},ze={class:"px-6 py-2"},He={class:"text-xs leading-5 lg:text-sm"},Ye=l("br",null,null,-1),Xe={key:0,class:"block mt-1 text-xl font-semibold leading-8"},qe={class:"px-6 py-2"},Ge={class:"text-xs leading-5 lg:text-sm"},Je=l("br",null,null,-1),Ke={key:0,class:"block mt-1 text-xl font-semibold leading-8",style:{color:"#00c99c"}},Qe={class:"px-6 py-2"},We={class:"text-xs leading-5 lg:text-sm"},Ze=l("br",null,null,-1),et={key:0,class:"block mt-1 text-xl font-semibold leading-8",style:{color:"#fb7178"}},tt={class:"px-6 py-2"},st={class:"text-xs leading-5 lg:text-sm"},at=l("br",null,null,-1),nt={key:0,class:"block mt-1 text-xl font-semibold leading-8",style:{color:"#5851d8"}},ot={setup(j){se();const C=M();K("utils");const s=O();let u=F(!1),r=R({}),a=R({}),_=R(["This year","Previous year"]),y=F("This year");const g=E(()=>r.expenseTotals?r.expenseTotals:[]),I=E(()=>r.netProfits?r.netProfits:[]),h=E(()=>r&&r.months?r.months:[]),B=E(()=>r.receiptTotals?r.receiptTotals:[]),x=E(()=>r.invoiceTotals?r.invoiceTotals:[]);ae(s,()=>{s.params.id&&$(),y.value="This year"},{immediate:!0});async function $(){u.value=!1;let i=await C.fetchViewCustomer({id:s.params.id});i.data&&(Object.assign(r,i.data.meta.chartData),Object.assign(a,i.data.data)),u.value=!0}async function D(i){let k={id:s.params.id};i==="Previous year"?k.previous_year=!0:k.this_year=!0;let c=await C.fetchViewCustomer(k);return c.data.meta.chartData&&Object.assign(r,c.data.meta.chartData),!0}return(i,k)=>{const c=d("BaseIcon"),w=d("BaseMultiselect"),T=d("BaseFormatMoney"),P=d("BaseCard");return o(),m(P,{class:"flex flex-col mt-6"},{default:n(()=>[e(C).isFetchingViewData?(o(),m(je,{key:0})):(o(),v("div",Le,[l("div",Re,[l("div",Me,[l("h6",Ne,[t(c,{name:"ChartSquareBarIcon",class:"h-5 text-primary-400"}),A(" "+b(i.$t("dashboard.monthly_chart.title")),1)]),l("div",Oe,[t(w,{modelValue:e(y),"onUpdate:modelValue":k[0]||(k[0]=V=>ne(y)?y.value=V:y=V),options:e(_),"allow-empty":!1,"show-labels":!1,placeholder:i.$t("dashboard.select_year"),"can-deselect":!1,onSelect:D},null,8,["modelValue","options","placeholder"])])]),e(u)?(o(),m(ie,{key:0,invoices:e(x),expenses:e(g),receipts:e(B),income:e(I),labels:e(h),class:"sm:w-full"},null,8,["invoices","expenses","receipts","income","labels"])):f("",!0)]),l("div",Ue,[l("div",ze,[l("span",He,b(i.$t("dashboard.chart_info.total_sales")),1),Ye,e(u)?(o(),v("span",Xe,[t(T,{amount:e(r).salesTotal,currency:e(a).currency},null,8,["amount","currency"])])):f("",!0)]),l("div",qe,[l("span",Ge,b(i.$t("dashboard.chart_info.total_receipts")),1),Je,e(u)?(o(),v("span",Ke,[t(T,{amount:e(r).totalExpenses,currency:e(a).currency},null,8,["amount","currency"])])):f("",!0)]),l("div",Qe,[l("span",We,b(i.$t("dashboard.chart_info.total_expense")),1),Ze,e(u)?(o(),v("span",et,[t(T,{amount:e(r).totalExpenses,currency:e(a).currency},null,8,["amount","currency"])])):f("",!0)]),l("div",tt,[l("span",st,b(i.$t("dashboard.chart_info.net_income")),1),at,e(u)?(o(),v("span",nt,[t(T,{amount:e(r).netProfit,currency:e(a).currency},null,8,["amount","currency"])])):f("",!0)])])])),t(Ce)]),_:1})}}},dt={setup(j){K("utils"),oe();const C=M(),s=le();X();const u=re(),r=O();F(null);const a=E(()=>C.selectedViewCustomer.customer?C.selectedViewCustomer.customer.name:"");let _=E(()=>C.isFetchingViewData);function y(){return s.hasAbilities([S.CREATE_ESTIMATE,S.CREATE_INVOICE,S.CREATE_PAYMENT,S.CREATE_EXPENSE])}function g(){return s.hasAbilities([S.DELETE_CUSTOMER,S.EDIT_CUSTOMER])}function I(){u.push("/admin/customers")}return(h,B)=>{const x=d("BaseButton"),$=d("router-link"),D=d("BaseIcon"),i=d("BaseDropdownItem"),k=d("BaseDropdown"),c=d("BasePageHeader"),w=d("BasePage");return o(),m(w,{class:"xl:pl-96"},{default:n(()=>[t(c,{title:e(a)},{actions:n(()=>[e(s).hasAbilities(e(S).EDIT_CUSTOMER)?(o(),m($,{key:0,to:`/admin/customers/${e(r).params.id}/edit`},{default:n(()=>[t(x,{class:"mr-3",variant:"primary-outline","content-loading":e(_)},{default:n(()=>[A(b(h.$t("general.edit")),1)]),_:1},8,["content-loading"])]),_:1},8,["to"])):f("",!0),y()?(o(),m(k,{key:1,position:"bottom-end","content-loading":e(_)},{activator:n(()=>[t(x,{class:"mr-3",variant:"primary","content-loading":e(_)},{default:n(()=>[A(b(h.$t("customers.new_transaction")),1)]),_:1},8,["content-loading"])]),default:n(()=>[e(s).hasAbilities(e(S).CREATE_ESTIMATE)?(o(),m($,{key:0,to:`/admin/estimates/create?customer=${h.$route.params.id}`},{default:n(()=>[t(i,{class:""},{default:n(()=>[t(D,{name:"DocumentIcon",class:"mr-3 text-gray-600"}),A(" "+b(h.$t("estimates.new_estimate")),1)]),_:1})]),_:1},8,["to"])):f("",!0),e(s).hasAbilities(e(S).CREATE_INVOICE)?(o(),m($,{key:1,to:`/admin/invoices/create?customer=${h.$route.params.id}`},{default:n(()=>[t(i,null,{default:n(()=>[t(D,{name:"DocumentTextIcon",class:"mr-3 text-gray-600"}),A(" "+b(h.$t("invoices.new_invoice")),1)]),_:1})]),_:1},8,["to"])):f("",!0),e(s).hasAbilities(e(S).CREATE_PAYMENT)?(o(),m($,{key:2,to:`/admin/payments/create?customer=${h.$route.params.id}`},{default:n(()=>[t(i,null,{default:n(()=>[t(D,{name:"CreditCardIcon",class:"mr-3 text-gray-600"}),A(" "+b(h.$t("payments.new_payment")),1)]),_:1})]),_:1},8,["to"])):f("",!0),e(s).hasAbilities(e(S).CREATE_EXPENSE)?(o(),m($,{key:3,to:`/admin/expenses/create?customer=${h.$route.params.id}`},{default:n(()=>[t(i,null,{default:n(()=>[t(D,{name:"CalculatorIcon",class:"mr-3 text-gray-600"}),A(" "+b(h.$t("expenses.new_expense")),1)]),_:1})]),_:1},8,["to"])):f("",!0)]),_:1},8,["content-loading"])):f("",!0),g()?(o(),m(de,{key:2,class:J({"ml-3":e(_)}),row:e(C).selectedViewCustomer,"load-data":I},null,8,["class","row"])):f("",!0)]),_:1},8,["title"]),t(be),t(ot)]),_:1})}}};export{dt as default};
