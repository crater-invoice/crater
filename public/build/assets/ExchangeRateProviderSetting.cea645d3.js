var ie=Object.defineProperty;var X=Object.getOwnPropertySymbols;var ue=Object.prototype.hasOwnProperty,de=Object.prototype.propertyIsEnumerable;var J=(C,c,n)=>c in C?ie(C,c,{enumerable:!0,configurable:!0,writable:!0,value:n}):C[c]=n,G=(C,c)=>{for(var n in c||(c={}))ue.call(c,n)&&J(C,n,c[n]);if(X)for(var n of X(c))de.call(c,n)&&J(C,n,c[n]);return C};import{g as K,t as Q,c as ge,i as ve}from"./main.c8c9089c.js";import{g as W,i as B,k as b,m as V,n as T,aU as Z,a3 as pe,q as he,D as L,l as me,r as v,o as k,s as I,w as l,t as y,v as w,x,y as e,b as s,A as M,z as ee,B as fe,am as ye,c as _e,a$ as xe,a0 as Ce,b0 as Ee,b1 as $e,b2 as be,F as Re,j as Be}from"./vendor.e9042f2c.js";import ke from"./BaseTable.07a27e7f.js";const we={class:"flex justify-between w-full"},Ve=["onSubmit"],Ie={class:"px-4 md:px-8 py-8 overflow-y-auto sm:p-6"},Se={class:"z-0 flex justify-end p-4 border-t border-gray-200 border-solid"},De={setup(C){const{t:c}=W();let n=B(!1),u=B(!1),E=B(!1),m=B([]),p=B([]);const _=K(),t=Q();let q=B([]);const z=b(()=>({currentExchangeRate:{key:{required:V.withMessage(c("validation.required"),T)},driver:{required:V.withMessage(c("validation.required"),T)},currencies:{required:V.withMessage(c("validation.required"),T)}},currencyConverter:{type:{required:V.withMessage(c("validation.required"),Z(i))},url:{required:V.withMessage(c("validation.required"),Z($)),url:V.withMessage(c("validation.invalid_url"),pe)}}})),A=b(()=>t.drivers.map(r=>Object.assign({},r,{key:c(r.key)}))),O=b(()=>_.active&&_.componentName==="ExchangeRateProviderModal");b(()=>_.title);const i=b(()=>t.currentExchangeRate.driver==="currency_converter"),$=b(()=>t.currencyConverter&&t.currencyConverter.type==="DEDICATED"),S=b(()=>{switch(t.currentExchangeRate.driver){case"currency_converter":return"https://www.currencyconverterapi.com";case"currency_freak":return"https://currencyfreaks.com";case"currency_layer":return"https://currencylayer.com";case"open_exchange_rate":return"https://openexchangerates.org";default:return""}}),o=he(z,b(()=>t));function N(){m.value=[]}function F(){const{currencies:r}=t.currentExchangeRate;m.value.forEach(a=>{r.forEach((h,f)=>{h===a&&r.splice(f,1)})}),m.value=[]}function P(){t.currentExchangeRate.key=null,t.currentExchangeRate.currencies=[],t.supportedCurrencies=[]}function d(){t.supportedCurrencies=[],p.value=[],t.currentExchangeRate={id:null,name:"",driver:"",key:"",active:!0,currencies:[]},t.currencyConverter={type:"",url:""},m.value=[]}async function D(){t.currentExchangeRate.driver="currency_converter";let r={};t.isEdit&&(r.provider_id=t.currentExchangeRate.id),u.value=!0,await t.fetchDefaultProviders(),await t.fetchActiveCurrency(r),p.value=t.currentExchangeRate.currencies,u.value=!1}L(()=>i.value,(r,a)=>{r&&ae()},{immediate:!0}),L(()=>t.currentExchangeRate.key,(r,a)=>{r&&U()}),L(()=>{var r;return(r=t==null?void 0:t.currencyConverter)==null?void 0:r.type},(r,a)=>{r&&U()}),U=me.exports.debounce(U,500);function te(){return o.value.$touch(),ne(),!!(o.value.$invalid||m.value.length&&t.currentExchangeRate.active)}async function re(){if(te())return!0;let r=G({},t.currentExchangeRate);i.value&&(r.driver_config=G({},t.currencyConverter),$.value||(r.driver_config.url=""));const a=t.isEdit?t.updateProvider:t.addProvider;n.value=!0,await a(r).then(h=>{n.value=!1,_.refreshData&&_.refreshData(),j()}).catch(h=>{n.value=!1})}async function ae(){let r=await t.getCurrencyConverterServers();q.value=r.data.currency_converter_servers,t.currencyConverter.type="FREE"}function U(){var h;const{driver:r,key:a}=t.currentExchangeRate;if(r&&a){E.value=!0;let f={driver:r,key:a};if(i.value&&!t.currencyConverter.type){E.value=!1;return}((h=t==null?void 0:t.currencyConverter)==null?void 0:h.type)&&(f.type=t.currencyConverter.type),t.fetchCurrencies(f).then(R=>{E.value=!1}).catch(R=>{E.value=!1})}}function ne(r=!0){var h;m.value=[];const{currencies:a}=t.currentExchangeRate;a.length&&((h=t.activeUsedCurrencies)==null?void 0:h.length)&&a.forEach(f=>{t.activeUsedCurrencies.includes(f)&&m.value.push(f)})}function j(){_.closeModal(),setTimeout(()=>{d(),o.value.$reset()},300)}return(r,a)=>{const h=v("BaseIcon"),f=v("BaseMultiselect"),R=v("BaseInputGroup"),Y=v("BaseInput"),oe=v("BaseSwitch"),se=v("BaseInputGrid"),le=v("BaseInfoAlert"),H=v("BaseButton"),ce=v("BaseModal");return k(),I(ce,{show:e(O),onClose:j,onOpen:D},{header:l(()=>[y("div",we,[w(x(e(_).title)+" ",1),s(h,{name:"XIcon",class:"w-6 h-6 text-gray-500 cursor-pointer",onClick:j})])]),default:l(()=>[y("form",{onSubmit:fe(re,["prevent"])},[y("div",Ie,[s(se,{layout:"one-column"},{default:l(()=>[s(R,{label:r.$tc("settings.exchange_rate.driver"),"content-loading":e(u),required:"",error:e(o).currentExchangeRate.driver.$error&&e(o).currentExchangeRate.driver.$errors[0].$message,"help-text":e(S)},{default:l(()=>[s(f,{modelValue:e(t).currentExchangeRate.driver,"onUpdate:modelValue":[a[0]||(a[0]=g=>e(t).currentExchangeRate.driver=g),P],options:e(A),"content-loading":e(u),"value-prop":"value","can-deselect":!0,label:"key",searchable:!0,invalid:e(o).currentExchangeRate.driver.$error,onInput:a[1]||(a[1]=g=>e(o).currentExchangeRate.driver.$touch())},null,8,["modelValue","options","content-loading","invalid"])]),_:1},8,["label","content-loading","error","help-text"]),e(i)?(k(),I(R,{key:0,required:"",label:r.$t("settings.exchange_rate.server"),"content-loading":e(u),error:e(o).currencyConverter.type.$error&&e(o).currencyConverter.type.$errors[0].$message},{default:l(()=>[s(f,{modelValue:e(t).currencyConverter.type,"onUpdate:modelValue":[a[2]||(a[2]=g=>e(t).currencyConverter.type=g),P],"content-loading":e(u),"value-prop":"value",searchable:"",options:e(q),invalid:e(o).currencyConverter.type.$error,label:"value"},null,8,["modelValue","content-loading","options","invalid"])]),_:1},8,["label","content-loading","error"])):M("",!0),s(R,{label:r.$t("settings.exchange_rate.key"),required:"","content-loading":e(u),error:e(o).currentExchangeRate.key.$error&&e(o).currentExchangeRate.key.$errors[0].$message},{default:l(()=>[s(Y,{modelValue:e(t).currentExchangeRate.key,"onUpdate:modelValue":a[3]||(a[3]=g=>e(t).currentExchangeRate.key=g),"content-loading":e(u),type:"text",name:"key",loading:e(E),"loading-position":"right",invalid:e(o).currentExchangeRate.key.$error},null,8,["modelValue","content-loading","loading","invalid"])]),_:1},8,["label","content-loading","error"]),e(t).supportedCurrencies.length?(k(),I(R,{key:1,label:r.$t("settings.exchange_rate.currency"),"content-loading":e(u),error:e(o).currentExchangeRate.currencies.$error&&e(o).currentExchangeRate.currencies.$errors[0].$message,"help-text":r.$t("settings.exchange_rate.currency_help_text")},{default:l(()=>[s(f,{modelValue:e(t).currentExchangeRate.currencies,"onUpdate:modelValue":a[4]||(a[4]=g=>e(t).currentExchangeRate.currencies=g),"content-loading":e(u),"value-prop":"code",mode:"tags",searchable:"",options:e(t).supportedCurrencies,invalid:e(o).currentExchangeRate.currencies.$error,label:"code","track-by":"code",onInput:a[5]||(a[5]=g=>e(o).currentExchangeRate.currencies.$touch()),openDirection:"top"},null,8,["modelValue","content-loading","options","invalid"])]),_:1},8,["label","content-loading","error","help-text"])):M("",!0),e($)?(k(),I(R,{key:2,label:r.$t("settings.exchange_rate.url"),"content-loading":e(u),error:e(o).currencyConverter.url.$error&&e(o).currencyConverter.url.$errors[0].$message},{default:l(()=>[s(Y,{modelValue:e(t).currencyConverter.url,"onUpdate:modelValue":a[6]||(a[6]=g=>e(t).currencyConverter.url=g),"content-loading":e(u),type:"url",invalid:e(o).currencyConverter.url.$error,onInput:a[7]||(a[7]=g=>e(o).currencyConverter.url.$touch())},null,8,["modelValue","content-loading","invalid"])]),_:1},8,["label","content-loading","error"])):M("",!0),s(oe,{modelValue:e(t).currentExchangeRate.active,"onUpdate:modelValue":a[8]||(a[8]=g=>e(t).currentExchangeRate.active=g),class:"flex","label-right":r.$t("settings.exchange_rate.active")},null,8,["modelValue","label-right"])]),_:1}),e(m).length&&e(t).currentExchangeRate.active?(k(),I(le,{key:0,class:"mt-5",title:r.$t("settings.exchange_rate.currency_in_used"),lists:[e(m).toString()],actions:["Remove"],onHide:N,onRemove:F},null,8,["title","lists"])):M("",!0)]),y("div",Se,[s(H,{class:"mr-3",variant:"primary-outline",type:"button",disabled:e(n),onClick:j},{default:l(()=>[w(x(r.$t("general.cancel")),1)]),_:1},8,["disabled"]),s(H,{loading:e(n),disabled:e(n)||e(E),variant:"primary",type:"submit"},{left:l(g=>[e(n)?M("",!0):(k(),I(h,{key:0,name:"SaveIcon",class:ee(g.class)},null,8,["class"]))]),default:l(()=>[w(" "+x(e(t).isEdit?r.$t("general.update"):r.$t("general.save")),1)]),_:1},8,["loading","disabled"])])],40,Ve)]),_:1},8,["show"])}}},Me={slot:"header",class:"flex flex-wrap justify-between lg:flex-nowrap"},qe={class:"text-lg font-medium text-left"},Ne={class:"mt-2 text-sm leading-snug text-left text-gray-500",style:{"max-width":"680px"}},Pe={class:"mt-4 lg:mt-0 lg:ml-2"},Ue={class:"capitalize"},je={class:"inline-block"},Ge={setup(C){const{tm:c,t:n}=W();ge();const u=Q(),E=K(),m=ve();let p=B("");const _=ye("utils"),t=b(()=>[{key:"driver",label:n("settings.exchange_rate.driver"),thClass:"extra",tdClass:"font-medium text-gray-900"},{key:"key",label:n("settings.exchange_rate.key"),thClass:"extra",tdClass:"font-medium text-gray-900"},{key:"active",label:n("settings.exchange_rate.active"),thClass:"extra",tdClass:"font-medium text-gray-900"},{key:"actions",label:"",tdClass:"text-right text-sm font-medium",sortable:!1}]);async function q({page:i,sort:$}){let S=Be({orderByField:$.fieldName||"created_at",orderBy:$.order||"desc",page:i}),o=await u.fetchProviders(S);return{data:o.data.data,pagination:{totalPages:o.data.meta.last_page,currentPage:i,totalCount:o.data.meta.total,limit:5}}}function z(){E.openModal({title:n("settings.exchange_rate.new_driver"),componentName:"ExchangeRateProviderModal",size:"md",refreshData:p.value&&p.value.refresh})}function A(i){u.fetchProvider(i),E.openModal({title:n("settings.exchange_rate.edit_driver"),componentName:"ExchangeRateProviderModal",size:"md",data:i,refreshData:p.value&&p.value.refresh})}function O(i){m.openDialog({title:n("general.are_you_sure"),message:n("settings.exchange_rate.exchange_rate_confirm_delete"),yesLabel:n("general.ok"),noLabel:n("general.cancel"),variant:"danger",hideNoButton:!1,size:"lg"}).then(async $=>{$&&(await u.deleteExchangeRate(i),p.value&&p.value.refresh())})}return(i,$)=>{const S=v("BaseButton"),o=v("BaseBadge"),N=v("BaseDropdownItem"),F=v("BaseDropdown"),P=v("BaseCard");return k(),_e(Re,null,[s(De),s(P,null,{default:l(()=>[y("div",Me,[y("div",null,[y("h6",qe,x(i.$t("settings.menu_title.exchange_rate")),1),y("p",Ne,x(i.$t("settings.exchange_rate.providers_description")),1)]),y("div",Pe,[s(S,{variant:"primary-outline",size:"lg",onClick:z},{left:l(d=>[s(e(xe),{class:ee(d.class)},null,8,["class"])]),default:l(()=>[w(" "+x(i.$t("settings.exchange_rate.new_driver")),1)]),_:1})])]),s(ke,{ref:(d,D)=>{D.table=d,Ce(p)?p.value=d:p=d},class:"mt-16",data:q,columns:e(t)},{"cell-driver":l(({row:d})=>[y("span",Ue,x(d.data.driver.replace("_"," ")),1)]),"cell-active":l(({row:d})=>[s(o,{"bg-color":e(_).getBadgeStatusColor(d.data.active?"YES":"NO").bgColor,color:e(_).getBadgeStatusColor(d.data.active?"YES":"NO").color},{default:l(()=>[w(x(d.data.active?"YES":"NO"),1)]),_:2},1032,["bg-color","color"])]),"cell-actions":l(({row:d})=>[s(F,null,{activator:l(()=>[y("div",je,[s(e(Ee),{class:"w-5 text-gray-500"})])]),default:l(()=>[s(N,{onClick:D=>A(d.data.id)},{default:l(()=>[s(e($e),{class:"h-5 mr-3 text-gray-600"}),w(" "+x(i.$t("general.edit")),1)]),_:2},1032,["onClick"]),s(N,{onClick:D=>O(d.data.id)},{default:l(()=>[s(e(be),{class:"h-5 mr-3 text-gray-600"}),w(" "+x(i.$t("general.delete")),1)]),_:2},1032,["onClick"])]),_:2},1024)]),_:1},8,["columns"])]),_:1})],64)}}};export{Ge as default};
