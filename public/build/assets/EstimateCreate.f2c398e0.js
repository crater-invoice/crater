var K=Object.defineProperty,Q=Object.defineProperties;var W=Object.getOwnPropertyDescriptors;var V=Object.getOwnPropertySymbols;var X=Object.prototype.hasOwnProperty,Z=Object.prototype.propertyIsEnumerable;var j=(a,e,n)=>e in a?K(a,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):a[e]=n,q=(a,e)=>{for(var n in e||(e={}))X.call(e,n)&&j(a,n,e[n]);if(V)for(var n of V(e))Z.call(e,n)&&j(a,n,e[n]);return a},L=(a,e)=>Q(a,W(e));import{r as o,o as g,e as T,f as s,u as t,w as l,J as ee,B as h,G as te,aN as ae,k as b,L as v,M as E,S as se,O as ne,aP as ie,T as oe,C as le,l as y,j as C,h as B,t as M,m as re,i as me,U as de,F as ue}from"./vendor.d12b5734.js";import{k as P,r as ce,b as pe,m as ge}from"./main.c7bd6c0e.js";import{_ as fe,a as _e,b as ve,c as be,d as ye,e as we,f as Ee}from"./SalesTax.67357751.js";import{_ as Be}from"./CreateCustomFields.04aba193.js";import{_ as $e}from"./ExchangeRateConverter.6e0e36e7.js";import{_ as Se}from"./TaxTypeModal.3db473e9.js";import"./DragIcon.d9f643cf.js";import"./SelectNotePopup.ead4330d.js";import"./NoteModal.c9605dba.js";import"./payment.2b6f850e.js";import"./exchange-rate.70a72e5f.js";const he={class:"md:grid-cols-12 grid-cols-1 md:gap-x-6 mt-6 mb-8 grid gap-y-5"},Ce={props:{v:{type:Object,default:null},isLoading:{type:Boolean,default:!1},isEdit:{type:Boolean,default:!1}},setup(a){const e=P();return(n,r)=>{const $=o("BaseCustomerSelectPopup"),m=o("BaseDatePicker"),c=o("BaseInputGroup"),p=o("BaseInput"),S=o("BaseInputGrid");return g(),T("div",he,[s($,{modelValue:t(e).newEstimate.customer,"onUpdate:modelValue":r[0]||(r[0]=d=>t(e).newEstimate.customer=d),valid:a.v.customer_id,"content-loading":a.isLoading,type:"estimate",class:"col-span-5 pr-0"},null,8,["modelValue","valid","content-loading"]),s(S,{class:"col-span-7"},{default:l(()=>[s(c,{label:n.$t("reports.estimates.estimate_date"),"content-loading":a.isLoading,required:"",error:a.v.estimate_date.$error&&a.v.estimate_date.$errors[0].$message},{default:l(()=>[s(m,{modelValue:t(e).newEstimate.estimate_date,"onUpdate:modelValue":r[1]||(r[1]=d=>t(e).newEstimate.estimate_date=d),"content-loading":a.isLoading,"calendar-button":!0,"calendar-button-icon":"calendar"},null,8,["modelValue","content-loading"])]),_:1},8,["label","content-loading","error"]),s(c,{label:n.$t("estimates.expiry_date"),"content-loading":a.isLoading},{default:l(()=>[s(m,{modelValue:t(e).newEstimate.expiry_date,"onUpdate:modelValue":r[2]||(r[2]=d=>t(e).newEstimate.expiry_date=d),"content-loading":a.isLoading,"calendar-button":!0,"calendar-button-icon":"calendar"},null,8,["modelValue","content-loading"])]),_:1},8,["label","content-loading"]),s(c,{label:n.$t("estimates.estimate_number"),"content-loading":a.isLoading,required:"",error:a.v.estimate_number.$error&&a.v.estimate_number.$errors[0].$message},{default:l(()=>[s(p,{modelValue:t(e).newEstimate.estimate_number,"onUpdate:modelValue":r[3]||(r[3]=d=>t(e).newEstimate.estimate_number=d),"content-loading":a.isLoading},null,8,["modelValue","content-loading"])]),_:1},8,["label","content-loading","error"]),s($e,{store:t(e),"store-prop":"newEstimate",v:a.v,"is-loading":a.isLoading,"is-edit":a.isEdit,"customer-currency":t(e).newEstimate.currency_id},null,8,["store","v","is-loading","is-edit","customer-currency"])]),_:1})])}}},ke=["onSubmit"],xe={class:"flex"},Ie={class:"block mt-10 estimate-foot lg:flex lg:justify-between lg:items-start"},Ve={class:"relative w-full lg:w-1/2"},He={setup(a){const e=P(),n=ce(),r=pe(),$=ge(),{t:m}=ee(),c="newEstimate";let p=h(!1);const S=h(!1),d=h(["customer","company","customerCustom","estimate","estimateCustom"]);let k=te(),F=ae(),f=b(()=>e.isFetchingInitialSettings),N=b(()=>_.value?m("estimates.edit_estimate"):m("estimates.new_estimate")),_=b(()=>k.name==="estimates.edit");const U=b(()=>r.selectedCompanySettings.sales_tax_us_enabled==="YES"&&n.salesTaxUSEnabled),D={estimate_date:{required:v.withMessage(m("validation.required"),E)},estimate_number:{required:v.withMessage(m("validation.required"),E)},reference_number:{maxLength:v.withMessage(m("validation.price_maxlength"),se(255))},customer_id:{required:v.withMessage(m("validation.required"),E)},exchange_rate:{required:ne(function(){return v.withMessage(m("validation.required"),E),e.showExchangeRate}),decimal:v.withMessage(m("validation.valid_exchange_rate"),ie)}},w=oe(D,b(()=>e.newEstimate),{$scope:c});le(()=>e.newEstimate.customer,i=>{i&&i.currency?e.newEstimate.selectedCurrency=i.currency:e.newEstimate.selectedCurrency=r.selectedCompanyCurrency}),e.resetCurrentEstimate(),$.resetCustomFields(),w.value.$reset,e.fetchEstimateInitialSettings(_.value);async function G(){if(w.value.$touch(),w.value.$invalid)return!1;p.value=!0;let i=L(q({},e.newEstimate),{sub_total:e.getSubTotal,total:e.getTotal,tax:e.getTotalTax});const x=_.value?e.updateEstimate:e.addEstimate;try{let u=await x(i);u.data.data&&F.push(`/admin/estimates/${u.data.data.id}/view`)}catch(u){console.error(u)}p.value=!1}return(i,x)=>{const u=o("BaseBreadcrumbItem"),R=o("BaseBreadcrumb"),I=o("BaseButton"),H=o("router-link"),O=o("BaseIcon"),z=o("BasePageHeader"),A=o("BaseScrollPane"),J=o("BasePage");return g(),T(ue,null,[s(fe),s(_e),s(Se),t(U)&&(!t(f)||t(k).query.customer)?(g(),y(ve,{key:0,store:t(e),"store-prop":"newEstimate","is-edit":t(_),customer:t(e).newEstimate.customer},null,8,["store","is-edit","customer"])):C("",!0),s(J,{class:"relative estimate-create-page"},{default:l(()=>[B("form",{onSubmit:de(G,["prevent"])},[s(z,{title:t(N)},{actions:l(()=>[i.$route.name==="estimates.edit"?(g(),y(H,{key:0,to:`/estimates/pdf/${t(e).newEstimate.unique_hash}`,target:"_blank"},{default:l(()=>[s(I,{class:"mr-3",variant:"primary-outline",type:"button"},{default:l(()=>[B("span",xe,M(i.$t("general.view_pdf")),1)]),_:1})]),_:1},8,["to"])):C("",!0),s(I,{loading:t(p),disabled:t(p),"content-loading":t(f),variant:"primary",type:"submit"},{left:l(Y=>[t(p)?C("",!0):(g(),y(O,{key:0,class:re(Y.class),name:"SaveIcon"},null,8,["class"]))]),default:l(()=>[me(" "+M(i.$t("estimates.save_estimate")),1)]),_:1},8,["loading","disabled","content-loading"])]),default:l(()=>[s(R,null,{default:l(()=>[s(u,{title:i.$t("general.home"),to:"/admin/dashboard"},null,8,["title"]),s(u,{title:i.$tc("estimates.estimate",2),to:"/admin/estimates"},null,8,["title"]),i.$route.name==="estimates.edit"?(g(),y(u,{key:0,title:i.$t("estimates.edit_estimate"),to:"#",active:""},null,8,["title"])):(g(),y(u,{key:1,title:i.$t("estimates.new_estimate"),to:"#",active:""},null,8,["title"]))]),_:1})]),_:1},8,["title"]),s(Ce,{v:t(w),"is-loading":t(f),"is-edit":t(_)},null,8,["v","is-loading","is-edit"]),s(A,null,{default:l(()=>[s(be,{currency:t(e).newEstimate.selectedCurrency,"is-loading":t(f),"item-validation-scope":c,store:t(e),"store-prop":"newEstimate"},null,8,["currency","is-loading","store"]),B("div",Ie,[B("div",Ve,[s(ye,{store:t(e),"store-prop":"newEstimate",fields:d.value,type:"Estimate"},null,8,["store","fields"]),s(Be,{type:"Estimate","is-edit":t(_),"is-loading":t(f),store:t(e),"store-prop":"newEstimate","custom-field-scope":c,class:"mb-6"},null,8,["is-edit","is-loading","store"]),s(we,{store:t(e),"component-name":"EstimateTemplate","store-prop":"newEstimate","is-mark-as-default":S.value},null,8,["store","is-mark-as-default"])]),s(Ee,{currency:t(e).newEstimate.selectedCurrency,"is-loading":t(f),store:t(e),"store-prop":"newEstimate","tax-popup-type":"estimate"},null,8,["currency","is-loading","store"])])]),_:1})],40,ke)]),_:1})],64)}}};export{He as default};
