var le=Object.defineProperty;var H=Object.getOwnPropertySymbols;var de=Object.prototype.hasOwnProperty,ie=Object.prototype.propertyIsEnumerable;var O=(p,n,l)=>n in p?le(p,n,{enumerable:!0,configurable:!0,writable:!0,value:l}):p[n]=l,R=(p,n)=>{for(var l in n||(n={}))de.call(n,l)&&O(p,l,n[l]);if(H)for(var l of H(n))ie.call(n,l)&&O(p,l,n[l]);return p};import{z as ce,C as ue,a0 as q,B as h,k as w,A as me,Y as fe,X as pe,r as i,o as u,e as v,f as o,w as r,u as s,l as S,i as _e,t as b,j as F,h as d,F as G,y as ye,m as ge}from"./vendor.dde0d540.js";import{c as he,e as ve,j as be,g as Be}from"./main.070de914.js";import{u as xe}from"./payment.201a2e03.js";import{_ as ke,a as we}from"./SendPaymentModal.e8ffc576.js";import{L as Fe}from"./LoadingIcon.6a4d8e19.js";import"./mail-driver.8d030ec7.js";const Ie={class:"fixed top-0 left-0 hidden h-full pt-16 pb-[6rem] ml-56 bg-white xl:ml-64 w-88 xl:block"},Pe={class:"flex items-center justify-between px-4 pt-8 pb-6 border border-gray-200 border-solid"},Ve={class:"flex ml-3",role:"group","aria-label":"First group"},Se={class:"px-4 py-1 pb-2 mb-2 text-sm border-b border-gray-200 border-solid"},Te={class:"px-2"},je={class:"px-2"},De={class:"px-2"},$e={class:"flex-2"},Le={class:"mb-1 text-xs not-italic font-medium leading-5 text-gray-500 capitalize"},ze={class:"mb-1 text-xs not-italic font-medium leading-5 text-gray-500 capitalize"},Me={class:"flex-1 whitespace-nowrap right"},Ce={class:"text-sm text-right text-gray-500 non-italic"},Ne={key:0,class:"flex justify-center p-4 items-center"},Ue={key:1,class:"flex justify-center px-4 mt-5 text-sm text-gray-600"},Ye={class:"flex flex-col min-h-0 mt-8 overflow-hidden",style:{height:"75vh"}},Ae=["src"],Je={setup(p){const n=ce(),{t:l}=ue();let y=q({}),a=q({orderBy:null,orderByField:null,searchText:null}),B=h(!1),I=h(!1);const x=xe(),X=he(),J=ve(),m=h(null),k=h(1),T=h(1),M=h(null),K=w(()=>y.payment_number||""),C=w(()=>a.orderBy==="asc"||a.orderBy==null);w(()=>C.value?l("general.ascending"):l("general.descending"));const N=w(()=>y.unique_hash?`/payments/pdf/${y.unique_hash}`:!1);w(()=>{var t;return me((t=x==null?void 0:x.selectedPayment)==null?void 0:t.payment_date).format("YYYY/MM/DD")}),fe(n,()=>{U()}),P(),U(),_=pe.exports.debounce(_,500);function Q(t){return n.params.id==t}be();async function P(t,c=!1){if(B.value)return;let f={};a.searchText!==""&&a.searchText!==null&&a.searchText!==void 0&&(f.search=a.searchText),a.orderBy!==null&&a.orderBy!==void 0&&(f.orderBy=a.orderBy),a.orderByField!==null&&a.orderByField!==void 0&&(f.orderByField=a.orderByField),B.value=!0;let V=await x.fetchPayments(R({page:t},f));B.value=!1,m.value=m.value?m.value:[],m.value=[...m.value,...V.data.data],k.value=t||1,T.value=V.data.meta.last_page;let g=m.value.find(j=>j.id==n.params.id);c==!1&&!g&&k.value<T.value&&Object.keys(f).length===0&&P(++k.value),g&&setTimeout(()=>{c==!1&&W()},500)}async function U(){if(!n.params.id)return;I.value=!0;let t=await x.fetchPayment(n.params.id);t.data&&(I.value=!1,Object.assign(y,t.data.data))}function W(){const t=document.getElementById(`payment-${n.params.id}`);t&&(t.scrollIntoView({behavior:"smooth"}),t.classList.add("shake"),Z())}function Z(){M.value.addEventListener("scroll",t=>{t.target.scrollTop>0&&t.target.scrollTop+t.target.clientHeight>t.target.scrollHeight-200&&k.value<T.value&&P(++k.value,!0)})}async function _(){m.value=[],P()}function ee(){return a.orderBy==="asc"?(a.orderBy="desc",_(),!0):(a.orderBy="asc",_(),!0)}async function te(){X.openModal({title:l("payments.send_payment"),componentName:"SendPaymentModal",id:y.id,data:y,variant:"lg"})}return(t,c)=>{const f=i("BaseButton"),V=i("BasePageHeader"),g=i("BaseIcon"),j=i("BaseInput"),D=i("BaseRadio"),$=i("BaseInputGroup"),L=i("BaseDropdownItem"),ae=i("BaseDropdown"),oe=i("BaseText"),se=i("BaseFormatMoney"),ne=i("router-link"),re=i("BasePage");return u(),v(G,null,[o(ke),o(re,{class:"xl:pl-96"},{default:r(()=>{var Y;return[o(V,{title:s(K)},{actions:r(()=>[s(J).hasAbilities(s(Be).SEND_PAYMENT)?(u(),S(f,{key:0,"content-loading":s(I),variant:"primary",onClick:te},{default:r(()=>[_e(b(t.$t("payments.send_payment_receipt")),1)]),_:1},8,["content-loading"])):F("",!0),o(we,{"content-loading":s(I),class:"ml-3",row:s(y)},null,8,["content-loading","row"])]),_:1},8,["title"]),d("div",Ie,[d("div",Pe,[o(j,{modelValue:s(a).searchText,"onUpdate:modelValue":c[0]||(c[0]=e=>s(a).searchText=e),placeholder:t.$t("general.search"),type:"text",onInput:_},{default:r(()=>[o(g,{name:"SearchIcon",class:"h-5"})]),_:1},8,["modelValue","placeholder"]),d("div",Ve,[o(ae,{position:"bottom-start","width-class":"w-50","position-class":"left-0"},{activator:r(()=>[o(f,{variant:"gray"},{default:r(()=>[o(g,{name:"FilterIcon"})]),_:1})]),default:r(()=>[d("div",Se,b(t.$t("general.sort_by")),1),d("div",Te,[o(L,{class:"pt-3 rounded-md hover:rounded-md"},{default:r(()=>[o($,{class:"-mt-3 font-normal"},{default:r(()=>[o(D,{id:"filter_invoice_number",modelValue:s(a).orderByField,"onUpdate:modelValue":[c[1]||(c[1]=e=>s(a).orderByField=e),_],label:t.$t("invoices.title"),size:"sm",name:"filter",value:"invoice_number"},null,8,["modelValue","label"])]),_:1})]),_:1})]),d("div",je,[o(L,{class:"pt-3 rounded-md hover:rounded-md"},{default:r(()=>[o($,{class:"-mt-3 font-normal"},{default:r(()=>[o(D,{modelValue:s(a).orderByField,"onUpdate:modelValue":[c[2]||(c[2]=e=>s(a).orderByField=e),_],label:t.$t("payments.date"),size:"sm",name:"filter",value:"payment_date"},null,8,["modelValue","label"])]),_:1})]),_:1})]),d("div",De,[o(L,{class:"pt-3 rounded-md hover:rounded-md"},{default:r(()=>[o($,{class:"-mt-3 font-normal"},{default:r(()=>[o(D,{id:"filter_payment_number",modelValue:s(a).orderByField,"onUpdate:modelValue":[c[3]||(c[3]=e=>s(a).orderByField=e),_],label:t.$t("payments.payment_number"),size:"sm",name:"filter",value:"payment_number"},null,8,["modelValue","label"])]),_:1})]),_:1})])]),_:1}),o(f,{class:"ml-1",size:"md",variant:"gray",onClick:ee},{default:r(()=>[s(C)?(u(),S(g,{key:0,name:"SortAscendingIcon"})):(u(),S(g,{key:1,name:"SortDescendingIcon"}))]),_:1})])]),d("div",{ref:(e,z)=>{z.paymentListSection=e,M.value=e},class:"h-full overflow-y-scroll border-l border-gray-200 border-solid"},[(u(!0),v(G,null,ye(m.value,(e,z)=>(u(),v("div",{key:z},[e?(u(),S(ne,{key:0,id:"payment-"+e.id,to:`/admin/payments/${e.id}/view`,class:ge(["flex justify-between p-4 items-center cursor-pointer hover:bg-gray-100 border-l-4 border-transparent",{"bg-gray-100 border-l-4 border-primary-500 border-solid":Q(e.id)}]),style:{"border-bottom":"1px solid rgba(185, 193, 209, 0.41)"}},{default:r(()=>{var A,E;return[d("div",$e,[o(oe,{text:(A=e==null?void 0:e.customer)==null?void 0:A.name,length:30,class:"pr-2 mb-2 text-sm not-italic font-normal leading-5 text-black capitalize truncate"},null,8,["text"]),d("div",Le,b(e==null?void 0:e.payment_number),1),d("div",ze,b(e==null?void 0:e.invoice_number),1)]),d("div",Me,[o(se,{class:"block mb-2 text-xl not-italic font-semibold leading-8 text-right text-gray-900",amount:e==null?void 0:e.amount,currency:(E=e.customer)==null?void 0:E.currency},null,8,["amount","currency"]),d("div",Ce,b(e.formatted_payment_date),1)])]}),_:2},1032,["id","to","class"])):F("",!0)]))),128)),s(B)?(u(),v("div",Ne,[o(Fe,{class:"h-6 m-1 animate-spin text-primary-400"})])):F("",!0),!((Y=m.value)==null?void 0:Y.length)&&!s(B)?(u(),v("p",Ue,b(t.$t("payments.no_matching_payments")),1)):F("",!0)],512)]),d("div",Ye,[s(N)?(u(),v("iframe",{key:0,src:s(N),class:"flex-1 border border-gray-400 border-solid rounded-md"},null,8,Ae)):F("",!0)])]}),_:1})],64)}}};export{Je as default};
