import{D as ne,ao as re,K as ie,a5 as de,e as ue,g,J as ce,F as me,l as S,z as ve,N as fe,r as i,o as d,c as T,a as s,n as f,w as o,b as u,m as n,O as z,q as F,t as p,I as _,L as j,M as pe,H as _e}from"./main-vzIkKseS.js";import{_ as ye}from"./SendInvoiceModal-DTdeZlwF.js";import{_ as ge}from"./InvoiceIndexDropdown-pu_jVPSm.js";import{L as be}from"./LoadingIcon-fUkhTV3p.js";import"./mail-driver-9YpfUUN4.js";const he={class:"text-sm mr-3"},Be={class:"fixed top-0 left-0 hidden h-full pt-16 pb-[6.4rem] ml-56 bg-white xl:ml-64 w-88 xl:block"},xe={class:"flex items-center justify-between px-4 pt-8 pb-2 border border-gray-200 border-solid height-full"},Ie={class:"mb-6"},ke={class:"flex mb-6 ml-3",role:"group","aria-label":"First group"},Se={class:"px-2 py-1 pb-2 mb-1 mb-2 text-sm border-b border-gray-200 border-solid"},Te={class:"flex-2"},we={class:"mt-1 mb-2 text-xs not-italic font-medium leading-5 text-gray-600"},Ee={class:"flex-1 whitespace-nowrap right"},Fe={class:"text-sm not-italic font-normal leading-5 text-right text-gray-600 est-date"},Ve={key:0,class:"flex justify-center p-4 items-center"},$e={key:1,class:"flex justify-center px-4 mt-5 text-sm text-gray-600"},De={class:"flex flex-col min-h-0 mt-8 overflow-hidden",style:{height:"75vh"}},Ne=["src"],Ue={setup(Le){const H=ne(),V=re(),$=ie(),O=de(),{t:y}=ue(),l=g(null),h=ce(),w=g(!1),B=g(!1),c=g(null),x=g(1),D=g(1),M=g(null),t=me({orderBy:null,orderByField:null,searchText:null}),q=S(()=>l.value.invoice_number),P=S(()=>t.orderBy==="asc"||t.orderBy==null);S(()=>P.value?y("general.ascending"):y("general.descending"));const G=S(()=>`/invoices/pdf/${l.value.unique_hash}`);S(()=>l.value&&l.value.id?invoice.value.id:null),ve(h,(e,r)=>{e.name==="invoices.view"&&U()});async function J(){O.openDialog({title:y("general.are_you_sure"),message:y("invoices.invoice_mark_as_sent"),yesLabel:y("general.ok"),noLabel:y("general.cancel"),variant:"primary",hideNoButton:!1,size:"lg"}).then(async e=>{w.value=!1,e&&(await V.markAsSent({id:l.value.id,status:"SENT"}),l.value.status="SENT",w.value=!0),w.value=!1})}async function K(e){H.openModal({title:y("invoices.send_invoice"),componentName:"SendInvoiceModal",id:l.value.id,data:l.value})}function W(e){return h.params.id==e}async function I(e,r=!1){if(B.value)return;let m={};t.searchText!==""&&t.searchText!==null&&t.searchText!==void 0&&(m.search=t.searchText),t.orderBy!==null&&t.orderBy!==void 0&&(m.orderBy=t.orderBy),t.orderByField!==null&&t.orderByField!==void 0&&(m.orderByField=t.orderByField),B.value=!0;let k=await V.fetchInvoices({page:e,...m});B.value=!1,c.value=c.value?c.value:[],c.value=[...c.value,...k.data.data],x.value=e||1,D.value=k.data.meta.last_page;let E=c.value.find(b=>b.id==h.params.id);r==!1&&!E&&x.value<D.value&&Object.keys(m).length===0&&I(++x.value),E&&setTimeout(()=>{r==!1&&Y()},500)}function Y(){const e=document.getElementById(`invoice-${h.params.id}`);e&&(e.scrollIntoView({behavior:"smooth"}),e.classList.add("shake"),Q())}function Q(){M.value.addEventListener("scroll",e=>{e.target.scrollTop>0&&e.target.scrollTop+e.target.clientHeight>e.target.scrollHeight-200&&x.value<D.value&&I(++x.value,!0)})}async function U(){let e=await V.fetchInvoice(h.params.id);e.data&&(l.value={...e.data.data})}async function v(){c.value=[],I()}function X(){return t.orderBy==="asc"?(t.orderBy="desc",v(),!0):(t.orderBy="asc",v(),!0)}function Z(){let e=c.value.findIndex(r=>r.id===l.value.id);c.value[e]&&(c.value[e].status="SENT",l.value.status="SENT")}return I(),U(),v=fe.debounce(v,500),(e,r)=>{const m=i("BaseButton"),k=i("router-link"),E=i("BasePageHeader"),b=i("BaseIcon"),ee=i("BaseInput"),N=i("BaseRadio"),L=i("BaseInputGroup"),A=i("BaseDropdownItem"),te=i("BaseDropdown"),ae=i("BaseText"),se=i("BaseEstimateStatusBadge"),oe=i("BaseFormatMoney"),le=i("BasePage");return d(),T(j,null,[s(ye,{onUpdate:Z}),l.value?(d(),f(le,{key:0,class:"xl:pl-96 xl:ml-8"},{default:o(()=>{var R;return[s(E,{title:n(q)},{actions:o(()=>[u("div",he,[l.value.status==="DRAFT"&&n($).hasAbilities(n(z).EDIT_INVOICE)?(d(),f(m,{key:0,disabled:w.value,variant:"primary-outline",onClick:J},{default:o(()=>[F(p(e.$t("invoices.mark_as_sent")),1)]),_:1},8,["disabled"])):_("",!0)]),l.value.status==="DRAFT"&&n($).hasAbilities(n(z).SEND_INVOICE)?(d(),f(m,{key:0,variant:"primary",class:"text-sm",onClick:K},{default:o(()=>[F(p(e.$t("invoices.send_invoice")),1)]),_:1})):_("",!0),n($).hasAbilities(n(z).CREATE_PAYMENT)?(d(),f(k,{key:1,to:`/admin/payments/${e.$route.params.id}/create`},{default:o(()=>[l.value.status==="SENT"||l.value.status==="VIEWED"?(d(),f(m,{key:0,variant:"primary"},{default:o(()=>[F(p(e.$t("invoices.record_payment")),1)]),_:1})):_("",!0)]),_:1},8,["to"])):_("",!0),s(ge,{class:"ml-3",row:l.value,"load-data":I},null,8,["row"])]),_:1},8,["title"]),u("div",Be,[u("div",xe,[u("div",Ie,[s(ee,{modelValue:n(t).searchText,"onUpdate:modelValue":r[0]||(r[0]=a=>n(t).searchText=a),placeholder:e.$t("general.search"),type:"text",variant:"gray",onInput:r[1]||(r[1]=a=>v())},{right:o(()=>[s(b,{name:"SearchIcon",class:"h-5 text-gray-400"})]),_:1},8,["modelValue","placeholder"])]),u("div",ke,[s(te,{class:"ml-3",position:"bottom-start"},{activator:o(()=>[s(m,{size:"md",variant:"gray"},{default:o(()=>[s(b,{name:"FilterIcon"})]),_:1})]),default:o(()=>[u("div",Se,p(e.$t("general.sort_by")),1),s(A,{class:"flex px-1 py-2 cursor-pointer"},{default:o(()=>[s(L,{class:"-mt-3 font-normal"},{default:o(()=>[s(N,{id:"filter_invoice_date",modelValue:n(t).orderByField,"onUpdate:modelValue":[r[2]||(r[2]=a=>n(t).orderByField=a),v],label:e.$t("reports.invoices.invoice_date"),size:"sm",name:"filter",value:"invoice_date"},null,8,["modelValue","label"])]),_:1})]),_:1}),s(A,{class:"flex px-1 py-2 cursor-pointer"},{default:o(()=>[s(L,{class:"-mt-3 font-normal"},{default:o(()=>[s(N,{id:"filter_due_date",modelValue:n(t).orderByField,"onUpdate:modelValue":[r[3]||(r[3]=a=>n(t).orderByField=a),v],label:e.$t("invoices.due_date"),value:"due_date",size:"sm",name:"filter"},null,8,["modelValue","label"])]),_:1})]),_:1}),s(A,{class:"flex px-1 py-2 cursor-pointer"},{default:o(()=>[s(L,{class:"-mt-3 font-normal"},{default:o(()=>[s(N,{id:"filter_invoice_number",modelValue:n(t).orderByField,"onUpdate:modelValue":[r[4]||(r[4]=a=>n(t).orderByField=a),v],label:e.$t("invoices.invoice_number"),value:"invoice_number",size:"sm",name:"filter"},null,8,["modelValue","label"])]),_:1})]),_:1})]),_:1}),s(m,{class:"ml-1",size:"md",variant:"gray",onClick:X},{default:o(()=>[n(P)?(d(),f(b,{key:0,name:"SortAscendingIcon"})):(d(),f(b,{key:1,name:"SortDescendingIcon"}))]),_:1})])]),u("div",{ref:(a,C)=>{C.invoiceListSection=a,M.value=a},class:"h-full overflow-y-scroll border-l border-gray-200 border-solid base-scroll"},[(d(!0),T(j,null,pe(c.value,(a,C)=>(d(),T("div",{key:C},[a?(d(),f(k,{key:0,id:"invoice-"+a.id,to:`/admin/invoices/${a.id}/view`,class:_e(["flex justify-between side-invoice p-4 cursor-pointer hover:bg-gray-100 items-center border-l-4 border-transparent",{"bg-gray-100 border-l-4 border-primary-500 border-solid":W(a.id)}]),style:{"border-bottom":"1px solid rgba(185, 193, 209, 0.41)"}},{default:o(()=>[u("div",Te,[s(ae,{text:a.customer.name,length:30,class:"pr-2 mb-2 text-sm not-italic font-normal leading-5 text-black capitalize truncate"},null,8,["text"]),u("div",we,p(a.invoice_number),1),s(se,{status:a.status,class:"px-1 text-xs"},{default:o(()=>[F(p(a.status),1)]),_:2},1032,["status"])]),u("div",Ee,[s(oe,{class:"mb-2 text-xl not-italic font-semibold leading-8 text-right text-gray-900 block",amount:a.total,currency:a.customer.currency},null,8,["amount","currency"]),u("div",Fe,p(a.formatted_invoice_date),1)])]),_:2},1032,["id","to","class"])):_("",!0)]))),128)),B.value?(d(),T("div",Ve,[s(be,{class:"h-6 m-1 animate-spin text-primary-400"})])):_("",!0),!((R=c.value)!=null&&R.length)&&!B.value?(d(),T("p",$e,p(e.$t("invoices.no_matching_invoices")),1)):_("",!0)],512)]),u("div",De,[u("iframe",{src:`${n(G)}`,class:"flex-1 border border-gray-400 border-solid bg-white rounded-md frame-style"},null,8,Ne)])]}),_:1})):_("",!0)],64)}}};export{Ue as default};
